!function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,a=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),n=a&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,i=(a||o)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,i,r,l,s,u;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),i=new ArrayBuffer(e.length),r=new Uint8Array(i),l=0;l<e.length;l+=1)r[l]=e.charCodeAt(l);return s=t.split(",")[0].split(":")[1].split(";")[0],a?new Blob([n?r:i],{type:s}):(u=new o,u.append(i),u.getBlob(s))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,a,n){t(n&&e.toDataURL&&i?i(this.toDataURL(a,n)):this.mozGetAsFile("blob",a))}:e.toDataURL&&i&&(e.toBlob=function(t,e,a){t(i(this.toDataURL(e,a)))})),"function"==typeof define&&define.amd?define(function(){return i}):t.dataURLtoBlob=i}(window),window.resize=function(){"use strict";function t(){}return t.prototype={init:function(t){this.outputQuality="undefined"===t?.8:t},photo:function(t,e,a,n,o,i){var r=this,l=new FileReader;l.onload=function(l){var s=new FileReader;s.onload=function(s){for(var u,c="",d=new Uint8Array(s.target.result).subarray(0,4),f=0;f<d.length;f++)c+=d[f].toString(16);switch(c){case"89504e47":u="image/png";break;case"47494638":u="image/gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":u="image/jpeg";break;default:u=t.type;break}i&&(u=i),r.resize(l.target.result,u,e,a,n,o)},s.readAsArrayBuffer(t)},l.readAsDataURL(t)},resize:function(t,e,a,n,o,i){var r=this,l=new Image;l.onload=function(t){var s=document.createElement("canvas"),u=l.width,c=l.height;u>c?u>a&&(c*=a/u,u=a):c>a&&(u*=a/c,c=a),s.width=u,s.height=c,s.getContext("2d").drawImage(l,0,0,u,c),r.output(s,e,n,o,i)},l.src=t},output:function(t,e,a,n,o){switch(a){case"file":t.toBlob(function(t){o(t)},e,n);break;case"dataURL":o(t.toDataURL(e,n));break}}},t}(),function($){$.fn.imageUpload=function(){var t=new window.resize;t.init();var e={dataURLtoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return new Blob([n],{type:a})},fileSize:function(t){var e=Math.floor(Math.log(t)/Math.log(1024));return 1*(t/Math.pow(1024,e)).toFixed(2)+" "+["B","kB","MB","GB","TB"][e]},setThumbnail:function(t,e,a,n,o){var i=$('<div class="form-image-upload-thumbnail"><div class="menu-overlay"><a href="#" class="remove-anchor"><i class="remove large icon"></i>'+e+'</a><a href="'+n+'" class="download-anchor" target="_blank"><i class="download large icon"></i>'+a+'</a></div><img src=""></div></div>');o||(o=n),i.find("img").attr("src",o),t.empty().append(i)},setButtonLabel:function(t,e){t.find("span").text(e)}};return this.each(function(){var a=$(this).parent(),n=a.find(".button"),o=a.find("input[type=file]"),i=a.find("textarea"),r=parseFloat(a.data("image-quality")),l=a.data("image-width"),s=a.data("thumb-width"),u=$(a.data("thumb-container")),c=a.data("attach-label"),d=a.data("replace-label"),f=a.data("remove-label"),b=a.data("download-label"),p=a.data("no-thumb-container"),h=null;1===p&&(u.before($('<div id="'+a.data("thumb-container").replace("#","").replace(".","")+'-no-thumb" class="form-image-upload-no-thumbnail"></div>')),h=$(a.data("thumb-container")+"-no-thumb")),""!==i.val()?e.setThumbnail(u,f,b,i.val()):h&&h.css("display","block"),u.on("click","a.remove-anchor",function(t){t.preventDefault(),u.empty(),e.setButtonLabel(n,c),i.val(""),h&&h.css("display","block")}),n.on("click",function(t){t.preventDefault(),o.click()}),a.on("change","input[type=file]",function(a){a.preventDefault();var o=a.target.files;o.length>0&&n.toggleClass("loading");for(var c in o){if("object"!=typeof o[c])return!1;!function(){var a=o[c].size;t.photo(o[c],l,"dataURL",r,function(a){i.val(a),e.setButtonLabel(n,d),n.hasClass("red")&&n.removeClass("red").addClass("basic"),t.photo(e.dataURLtoBlob(a),s,"dataURL",r,function(t){h&&h.css("display","none"),e.setThumbnail(u,f,b,a,t),n.toggleClass("loading")})})}()}})})}}(jQuery);